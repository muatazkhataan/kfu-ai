## مستند سياق وتوصيف تطبيق "مساعد كفو" لفريق تطوير فلاتر (Flutter)

هذا المستند يعرّف رؤية التطبيق، نطاقه، شاشاته، أسلوب التصميم والسمات، هيكلية المشروع في فلاتر، متطلبات الوظائف، وتجربة المستخدم، ليكون مرجعاً كاملاً لفريق تطوير تطبيق جوّال يعمل على iOS وAndroid باستخدام Flutter.

### 1) نظرة عامة على المنتج
- **اسم التطبيق**: مساعد كفو
- **الفئة**: مساعد ذكي للطلبة (تعليمي/إنتاجية)
- **المنصات المستهدفة**: iOS, Android (Flutter)
- **الجمهور المستهدف**: طلاب جامعة الملك فيصل في المقام الأول، مع قابلية التوسّع لجامعات أخرى.
- **لغة الواجهة**: عربية افتراضياً، مع دعم الإنجليزية (تبديل فوري داخل التطبيق).
- **الوضعيات**: سمة فاتحة/داكنة، مع وضع تلقائي حسب نظام الجهاز.
- **القيمة الأساسية**: تنظيم المحادثات مع مساعد ذكي، إدارة مجلدات وسجل المحادثات، إعدادات مظهر وسلوك متقدمة، مركز مساعدة، ونموذج إرسال ملاحظات.

### 2) أهداف التطبيق والغرض منه
- **مساعدة دراسية وأكاديمية**: تقديم دعم فوري في الدراسة والشؤون الأكاديمية.
- **تنظيم المعرفة**: إدارة المحادثات ضمن مجلدات وعرض سجل المحادثات.
- **تخصيص التجربة**: إعدادات مرنة للمظهر، اللغة، الخطوط، الإشعارات، وسلوك المحادثة.
- **قابلية المشاركة**: مشاركة محادثات وتصدير البيانات (لاحقاً وفق سياسة الخصوصية).

### 3) مرجعية الويب والتحويل لفلاتر
- المرجع التصميمي والوظيفي مأخوذ من صفحات الويب:
  - `login.html`: تدفّق تسجيل الدخول على خطوتين (اسم المستخدم ثم كلمة المرور) مع انتقالات حركية.
  - `chat.html`: الشاشة الرئيسية للمحادثة، الشريط الجانبي (مجلدات/سجل)، منطقة الرسائل، مُدخل الرسالة، شريط أدوات.
  - `settings.html`: إعدادات عامّة، المظهر، المحادثة، الخصوصية، الإشعارات، الذكاء الاصطناعي، البيانات، حول التطبيق.
  - `help.html`: دليل استخدام متعدد الأقسام مع ترويسات وإجراءات سريعة.
  - `feedback.html`: نموذج إرسال ملاحظات متعدد الحقول مع رفع صور.

التطبيق المحمول يجب أن يعكس نفس البُنى والمكوّنات بما يناسب تجربة الجوال وGuidelines المنصّات.

### 4) أسلوب التصميم والسمات
- **الأسلوب**: بسيط، أنيق، Minimal Swiss Design، متسق مع هوية الجامعة.
- **الألوان**: الاعتماد على نظام ألوان يمكن تعميمه كسِمات (Theme Tokens). اللون الأساسي Primary مشتق من Bootstrap RTL المستخدم في الويب مع دعم تباين مناسب للوضع الداكن.
- **الأيقونات**: استخدام FontAwesome 7 fa-regular مع حزمة `font_awesome_flutter` + أيقونة هوية KFU كـ SVG.
- **الحركة والانتقالات**: حركات دقيقة ذات معنى (micro-interactions)، مؤشرات كتابة، انتقالات بين الشاشات والانزلاقات الجانبية.
- **إمكانية الوصول**: تباين عالٍ، دعم أحجام خط قابلة للتعديل، دعم قارئ الشاشة.

### 5) نظام الألوان والخطوط (خطة السمات والوضع الليلي)
- الخط الافتراضي: IBM Plex Sans Arabic للعربية بجميع الأوزان (100-900)، وSystem/Inter للإنجليزية. إمكانية التبديل ضمن الإعدادات.
- الأيقونات: FontAwesome 7 fa-regular مع دعم جميع الأيقونات المطلوبة للتطبيق.
- تعريف سمات ضوئية/داكنة بوضوح عبر Tokens قابلة للتوسّع:

```yaml
# مثال Tokens منطقية (مرجعية، لا تُستخدم مباشرة)
colors:
  primary:        # اللون المؤسسي
    light: "#0d6efd"
    dark:  "#66a3ff"
  surface:
    light: "#ffffff"
    dark:  "#0f1115"
  surfaceAlt:
    light: "#f8f9fa"
    dark:  "#171a21"
  textPrimary:
    light: "#1f2328"
    dark:  "#e6e8ea"
  textSecondary:
    light: "#6c757d"
    dark:  "#a0a6ad"
  border:
    light: "#dee2e6"
    dark:  "#2a2f36"
```

- أحجام الخطوط (XS/S/M/L/XL) مع تعيين دلالي لعناوين وبنود نصية، وتدرّج وزن الخط بحسب المحتوى العربي.
- الوضع التلقائي يختار السمة وفق تفضيل النظام، مع إمكانية فرض السمة من الإعدادات.

### 6) تعدد اللغات (i18n)
- العربية افتراضية، الإنجليزية اختيارية عبر إعدادات التطبيق.
- تحميل الترجمات عبر `flutter_localizations` و`intl` مع نظام ARB فقط.
- كل النصوص في كتالوج ARB منفصل، مع مفاتيح دلالية.
- اتجاه الواجهة (RTL/LTR) يتبدّل وفق اللغة المختارة.

### 7) هيكلية المشروع في Flutter (مقترح)
```text
lib/
  app/
    app.dart                 # MaterialApp, Router, Themes, Localization
    routes.dart              # تعريف المسارات وتبديلها
    di.dart                  # حقن التبعيات (GetIt)
  core/
    config/                  # ثوابت، مفاتيح، إعدادات عامة
    theme/                   # تعريف السمات وتبديلها، tokens
    localization/            # مزود اللغات وترجمة المفاتيح
    utils/                   # أدوات عامة (format, validators)
    widgets/                 # Widgets مشتركة (Buttons, Cards, Modals)
  features/
    auth/                    # تسجيل الدخول/الخروج
      data/                  # مزود بيانات (محلي/شبكي)
      domain/                # نماذج واستخدامات
      presentation/          # شاشات/حالات/مقدمي حالة
    chat/
      data/
      domain/
      presentation/          # شاشة المحادثة، الرسائل، الإدخال، الشريط الجانبي
    chat_history/
      data/                  # مزود بيانات سجل المحادثات
      domain/                # نماذج سجل المحادثات، فلاتر البحث
      presentation/          # شاشة سجل المحادثات، البحث، التصفية، الترتيب
    folders/
      ...                    # إدارة المجلدات
    settings/
      ...                    # جميع أقسام الإعدادات
    help/
      ...
    feedback/
      ...
  services/
    storage/                 # تخزين محلي (Hive/Sqflite)
    notifications/           # إشعارات محلية
    share_export/            # مشاركة/تصدير محادثات
    search/                  # خدمة البحث في المحادثات
  state/
    app_state.dart           # حالة عامة (Theme/Locale/...)
    chat_history_state.dart  # حالة سجل المحادثات (البحث، التصفية، الترتيب)

assets/
  fonts/                     # IBM Plex Sans Arabic بجميع الأوزان، وأي خطوط إضافية
  images/                    # شعارات، صور ثابتة
  l10n/                      # ملفات الترجمة ARB فقط
  icons/                     # أيقونات SVG للمجلدات والإجراءات
```

### 8) البرمجة الشيئية (OOP) والهيكلية
- **الاعتماد الكامل على OOP**: جميع المكونات والخدمات يجب أن تُصمم باستخدام مبادئ البرمجة الشيئية.
- **التغليف (Encapsulation)**: إخفاء تفاصيل التنفيذ وتوفير واجهات واضحة للتفاعل.
- **الوراثة (Inheritance)**: استخدام الوراثة لإنشاء هرمية منطقية للمكونات المشتركة.
- **تعدد الأشكال (Polymorphism)**: استخدام الواجهات والكلاسات المجردة لمرونة التنفيذ.
- **التجريد (Abstraction)**: فصل الواجهة عن التنفيذ لسهولة الصيانة والتطوير.
- **مبادئ SOLID**: تطبيق مبادئ SOLID في جميع أنحاء المشروع لضمان جودة الكود.

#### أمثلة تطبيق OOP في المشروع:
```dart
// مثال على التغليف والوراثة
abstract class BaseRepository<T> {
  Future<List<T>> getAll();
  Future<T?> getById(String id);
  Future<void> save(T item);
  Future<void> delete(String id);
}

class ChatRepository extends BaseRepository<Chat> {
  final StorageService _storage;
  
  ChatRepository(this._storage);
  
  @override
  Future<List<Chat>> getAll() async {
    // تنفيذ محدد للمحادثات
  }
}

// مثال على تعدد الأشكال
abstract class SearchStrategy {
  Future<List<Chat>> search(String query);
}

class TextSearchStrategy implements SearchStrategy {
  @override
  Future<List<Chat>> search(String query) async {
    // بحث نصي
  }
}

class FolderSearchStrategy implements SearchStrategy {
  @override
  Future<List<Chat>> search(String query) async {
    // بحث في المجلدات
  }
}
```

### 9) إدارة الحالة والملاحة
- إدارة الحالة: `Riverpod` أو `Bloc/Cubit` (مقترح Riverpod للبساطة والاختبار).
- الملاحة: `go_router` لدعم Deep Links وتبسيط الانتقالات.
- حالة سجل المحادثات: إدارة حالة البحث، التصفية، الترتيب، والصفحات.
- انتقالات سلسة بين المحادثة الرئيسية وسجل المحادثات.

### 10) الشاشات والوظائف

#### أ) شاشة Splash Screen
- تعرض شعار KFU وأيقونة المساعد مع مؤثرات حركة تعبّر عن الذكاء الاصطناعي (نبض، نقاط متصلة، تموّجات).
- مدة قصيرة (2-3 ثوانٍ) ثم انتقال تلقائي لتسجيل الدخول أو الشاشة الرئيسية إن كان المستخدم مسجلاً.
- تحميل البيانات الأساسية (المجلدات، المحادثات الأخيرة) في الخلفية.

#### ب) شاشة تسجيل الدخول (مرجعية `login.html`)
- خطوتان:
  1) إدخال الرقم الجامعي، زر "التالي"، تحريك البطاقة يمين/يسار كما في الويب.
  2) إدخال كلمة المرور، خيار "تذكر رمز المرور"، أزرار "السابق" و"دخول".
- رسائل تنبيه نجاح/خطأ مطابقة للسلوك الحالي.
- دعم لوحة مفاتيح رقمية للحقل الأول إن أمكن.
- لا يتضمن ربط فعلي بخادم في المرحلة الأولى إلا إذا توفّر API لاحقاً، مع Stub/Mock.

#### ج) الشاشة الرئيسية للمحادثة (مرجعية `chat.html`)
- تكوين عام:
  - ترويسة تحتوي عنوان المحادثة وأزرار: مسح، تصدير، مشاركة.
  - منطقة رسائل تعرض:
    - رسالة ترحيب وبطاقات اقتراحات سريعة (كما في الويب) عند عدم وجود رسائل.
    - قائمة رسائل (مستخدم/مساعد) مع صور شخصية/أيقونة المساعد، وفق سمة اللون.
    - مؤشر الكتابة (Typing Indicator) بثلاث نقاط متحركة.
  - حقل إدخال نص متعدد الأسطر مع أزرار: إرفاق ملف، تسجيل صوتي، زر إرسال.
- الشريط الجانبي القابل للفتح/الإغلاق (سحب من اليمين على الجوال):
  - أقسام ثابتة: المجلدات (قابلة للتمديد/الطي)، المحادثات الأخيرة.
  - عناصر المجلدات: أيقونة FontAwesome 7، اسم، عدد المحادثات، قائمة إجراءات (إعادة تسمية، تغيير الأيقونة، حذف).
  - عناصر المحادثات الأخيرة: عنوان، معاينة، قائمة إجراءات (مشاركة، إعادة تسمية، إضافة لمجلد، أرشفة، حذف).
  - تذييل جانبي: روابط إلى "الإعدادات"، "المساعدة"، "إرسال ملاحظات"، "الصفحة الرئيسية"، و"تسجيل الخروج".
  - زر "عرض سجل المحادثات" في قسم "جميع المحادثات".

ملاحظات جوّال:
- الشريط الجانبي يصبح Drawer/ModalSheet.
- القوائم السياقية تتحول إلى `BottomSheet` أو `PopupMenuButton`.
- السحب للأرشفة/الحذف متاح عبر Gestures على عناصر المحادثة.
- استخدام IBM Plex Sans Arabic للنصوص و FontAwesome 7 للأيقونات.

#### د) شاشة سجل المحادثات (مرجعية `chat-history.html`)
- تكوين عام:
  - ترويسة تحتوي: زر فتح الشريط الجانبي، عنوان "سجل المحادثات"، أزرار: تحديث، تبديل العرض، العودة للمحادثة.
  - شريط البحث والتصفية:
    - حقل بحث مع أيقونة بحث FontAwesome 7 وزر مسح.
    - أزرار تصفية: جميع المحادثات، المحادثات الأخيرة، المحادثات المؤرشفة.
    - قائمة ترتيب: الأحدث أولاً، الأقدم أولاً، الاسم، عدد الرسائل.
  - قائمة المحادثات:
    - كل عنصر محادثة يحتوي:
      - رأس المحادثة: أيقونة FontAwesome 7، عنوان المحادثة، شارة عدد الرسائل.
      - معاينة المحادثة: نص معاينة مختصر بـ IBM Plex Sans Arabic.
      - تذييل المحادثة: التاريخ، أزرار الإجراءات (حذف، أرشفة، نقل لمجلد، مشاركة).
    - قائمة نقل للمجلد: البرمجة، هياكل البيانات، الخوارزميات، الشؤون الأكاديمية، مجلد جديد.
  - ترقيم الصفحات: تنقل بين صفحات المحادثات مع أرقام الصفحات.
  - حالة فارغة: رسالة "لا توجد محادثات" مع زر مسح المرشحات.
- الشريط الجانبي (نفس `chat.html`):
  - المجلدات مع إمكانية التمديد/الطي.
  - المحادثات الأخيرة.
  - تذييل مع روابط الإعدادات والمساعدة والملاحظات.

ملاحظات جوّال:
- البحث والتصفية في شريط علوي ثابت.
- قائمة المحادثات تستخدم `ListView.builder` مع lazy loading.
- أزرار الإجراءات تتحول إلى `PopupMenuButton` أو `BottomSheet`.
- السحب للأرشفة/الحذف متاح عبر `Dismissible`.
- ترقيم الصفحات يتحول إلى `PaginationView` أو infinite scroll.
- البحث يعمل فورياً مع debounce لتحسين الأداء.
- التصفية والترتيب يعملان مع حفظ الحالة في التخزين المحلي.
- استخدام IBM Plex Sans Arabic للنصوص و FontAwesome 7 للأيقونات.

#### هـ) إدارة المجلدات وسجل المحادثات
- إنشاء مجلد، إعادة تسمية، تغيير الأيقونة (مع فئات أيقونات FontAwesome 7 برمجية/رياضيات/علوم...).
- إضافة محادثة إلى مجلد موجود أو جديد.
- أرشفة محادثة/استعادتها.
- استخدام IBM Plex Sans Arabic لأسماء المجلدات والنصوص.
- عدّاد المحادثات داخل كل مجلد.
- البحث والتصفية في سجل المحادثات حسب التاريخ، المجلد، أو النص.
- ترقيم الصفحات أو التمرير اللانهائي للمحادثات الكثيرة.
- إدارة حالة البحث والتصفية مع حفظ التفضيلات.
- تحديث تلقائي لعدادات المجلدات عند إضافة/حذف محادثات.

#### و) الإعدادات (مرجعية `settings.html`)
- أقسام:
  - عام:
    - اللغة الافتراضية: عربي/إنجليزي، مع تبديل فوري وتحديث اتجاه الواجهة.
    - المنطقة الزمنية: اختيار من قائمة؛ تُستخدم للطوابع الزمنية.
    - الوضع التجريبي: تمكين ميزات تجريبية.
    - التحديث التلقائي: Placeholder للهامش المستقبلي.
  - المظهر:
    - اختيار السمة: فاتح/داكن/تلقائي.
    - حجم الخط: مصغّر/صغير/متوسط/كبير/كبير جداً (يرتبط بـ TextScaleFactor).
    - سلوك الشريط الجانبي: دائماً/عند التمرير/يدوياً (يتحوّل في الجوال إلى Drawer).
    - تفعيل الرسوم المتحركة.
  - المحادثة:
    - نمط الرد: مفصّل/مختصر/متوازن.
    - الحد الأقصى للرسائل: 50/100/200/غير محدود (للاحتفاظ المحلي).
    - الرد التلقائي، اقتراحات المحادثة، التصحيح التلقائي.
  - سجل المحادثات:
    - عدد المحادثات المعروضة في الصفحة الواحدة.
    - ترتيب افتراضي للمحادثات (تاريخ/اسم/عدد الرسائل).
    - تفعيل البحث التلقائي مع debounce.
    - حفظ حالة البحث والتصفية.
  - الخطوط والأيقونات:
    - اختيار عائلة الخط (IBM Plex Sans Arabic افتراضياً).
    - اختيار وزن الخط (100-900).
    - اختيار حجم الخط (XS/S/M/L/XL).
    - اختيار نمط الأيقونات (FontAwesome 7 fa-regular افتراضياً).
    - اختيار حجم الأيقونات (XS/S/M/L/XL).
  - الخصوصية:
    - جمع البيانات التحليلية (محلي/اختياري عبر مزوّد تحليلات لاحقاً).
    - حفظ سجل المحادثات محلياً (قابل للإلغاء).
    - مشاركة المحادثات (تمكين/تعطيل).
    - حذف جميع البيانات المحلية (زر واضح مع تأكيد مزدوج).
  - الإشعارات:
    - تفعيل الإشعارات المحلية.
    - إشعارات التحديثات والميزات الجديدة.
    - صوت الإشعارات.
  - إعدادات الذكاء الاصطناعي:
    - اختيار نموذج (نصي فقط الآن مع إمكانية الربط لاحقاً).
    - درجة الإبداع (Slider)، طول السياق المحفوظ، التعلم التكيفي، ميزات تجريبية.
  - البيانات والنسخ الاحتياطية:
    - نسخ احتياطي تلقائي محلي/سحابي (لاحقاً).
    - تصدير البيانات (JSON/ZIP/PDF للمحادثات).
    - عرض مساحة التخزين المستخدمة.
  - حول التطبيق:
    - شعار وهوية، الإصدار، وصف موجز، روابط السياسة والشروط والمساعدة والملاحظات.

ملاحظات جوّال:
- تقسيم الإعدادات إلى قوائم فرعية وعرض محتوى كقائمة بطاقات.
- استخدام `CupertinoPicker`/`DateTime` حسب المنصّة عند الملاءمة.

#### ز) المساعدة (مرجعية `help.html`)
- أقسام: البدء السريع، الميزات، دليل المحادثة، إدارة المجلدات، سجل المحادثات، الإعدادات، الخطوط والأيقونات، الأسئلة الشائعة.
- كل قسم يعرض بطاقات معلوماتية وصور/أيقونات داعمة.
- دليل استخدام سجل المحادثات: البحث، التصفية، الترتيب، الإجراءات.
- دليل تخصيص الخطوط والأيقونات: IBM Plex Sans Arabic، FontAwesome 7.
- بحث داخل المساعدة (محلي) مع ترشيح النتائج.

#### ح) إرسال ملاحظات (مرجعية `feedback.html`)
- نموذج يحتوي: الاسم، البريد، نوع الملاحظة، الأولوية، الموضوع، الوصف، رفع صور (حتى 5 صور × 5MB)، المتصفح/الجهاز (يُستعاض عنها بمعلومات الجهاز/النظام في الجوال)، موافقة على سياسة المشاركة.
- أزرار: إرسال، حفظ كمسوّدة، مسح النموذج.
- عرض "ملاحظاتي السابقة" مع ترشيح حسب الحالة/النوع.
- إمكانية إرسال ملاحظات حول مشاكل في سجل المحادثات أو اقتراحات تحسين.
- إمكانية إرسال ملاحظات حول مشاكل في الخطوط أو الأيقونات.

#### ط) تسجيل الخروج
- إجراء واضح مع تأكيد، ثم العودة إلى شاشة تسجيل الدخول.
- حفظ حالة البحث والتصفية في سجل المحادثات قبل تسجيل الخروج.
- حفظ إعدادات الخطوط والأيقونات قبل تسجيل الخروج.

### 11) النماذج والكيانات (Models)
- User { id, name, role, preferredLocale, rememberMe }
- Chat { id, title, preview, messages[], folderId?, archived, createdAt, updatedAt, messageCount }
- Message { id, senderType[user|assistant], text, attachments[], createdAt }
- Folder { id, name, iconKey, count, isFixed }
- ChatHistoryFilter { searchQuery, filterType[all|recent|archived], sortBy[date-desc|date-asc|title|messages], currentPage, itemsPerPage }
- ChatHistoryItem { chat, isSelected, isArchived, folderName }
- SearchResult { chat, relevanceScore, matchedText }
- FontConfig { family, weight, size, color }
- IconConfig { name, size, color, style }
- Settings: ThemeMode, FontScale, SidebarBehavior, Animations, ResponseStyle, MaxMessages, AutoResponse, Suggestions, AutoCorrect, Analytics, SaveHistory, Sharing, Notifications, NotificationSound, AIModel, Creativity, ContextLength, AdaptiveLearning, ExperimentalAI, Backup, StorageUsage, ChatHistoryPageSize, ChatHistoryDefaultSort, ChatHistorySearchDebounce, FontFamily, IconStyle
- Feedback { id, name, email, type, priority, subject, body, images[], deviceInfo, consent, status }

### 12) التخزين والبيانات
- **محلي**: Hive أو Isar لتخزين المحادثات، المجلدات، الإعدادات، الملاحظات.
- **الوسائط**: تخزين ملفات مرفقة في مجلد تطبيق آمن، مع إشارات مرجعية في السجل.
- **فهرسة البحث**: فهرس نصي للمحادثات لتمكين البحث السريع في سجل المحادثات.
- **فهرسة المجلدات**: فهرس للمجلدات مع عدد المحادثات في كل مجلد.
- **الترجمة**: تخزين ملفات ARB محلياً مع إمكانية التحديث.
- **الخطوط والأيقونات**: تخزين مؤقت للخطوط IBM Plex Sans Arabic والأيقونات FontAwesome 7.
- **التزامن السحابي (لاحقاً)**: طبقة مزوّد بيانات قابلة للاستبدال عبر واجهة Repository.
- **التصدير/المشاركة**: توليد JSON/ZIP، أو PDF للمحادثات.

### 13) الإشعارات
- إشعارات محلية للتذكير بالمحادثات/المهام (اختياري)، واحترام إعدادات المستخدم.
- إشعارات عند إضافة محادثات جديدة أو تحديثات في سجل المحادثات (اختياري).
- إشعارات عند إكمال البحث في سجل المحادثات (اختياري).
- إشعارات عند تحديث ملفات الترجمة ARB (اختياري).

### 14) الأذونات (Permissions)
- الوصول للميكروفون (تسجيل صوتي داخل المحادثة) — اختياري.
- الوصول للملفات/المعرض لرفع الصور — مع شروحات واضحة للمستخدم.
- الوصول للإنترنت (للبحث في سجل المحادثات إذا كان مطلوباً) — اختياري.
- الوصول للإنترنت (لتحميل الخطوط IBM Plex Sans Arabic والأيقونات FontAwesome 7) — اختياري.

### 15) الأداء والجودة
- تمرير سلس لقوائم الرسائل (ListView.builder/SliverList + lazy loading).
- تمرير سلس لقائمة سجل المحادثات مع تحميل تدريجي للعناصر.
- ضغط الصور قبل الحفظ.
- حفظ تلقائي للمسودات.
- فهرسة المحادثات للبحث السريع (Full-text search).
- تحسين البحث مع debounce وتخزين مؤقت للنتائج.
- تحسين تحميل الخطوط IBM Plex Sans Arabic مع التخزين المؤقت.
- تحسين عرض الأيقونات FontAwesome 7 مع التخزين المؤقت.
- اختبارات وحدات/ودجت للوظائف الحرجة (State, Repos, Formatters, Search).

### 16) الأمان والخصوصية
- حفظ كل البيانات محلياً افتراضياً.
- تشفير اختياري للقاعدة المحلية (Hive encryption) لكلمات المرور/الحساسيات.
- تشفير فهرس البحث في سجل المحادثات (اختياري).
- تشفير ملفات الترجمة ARB (اختياري).
- سياسة خصوصية واضحة وروابط من شاشة "حول".

### 17) إدارة الأخطاء وتجربة الاستخدام
- Snackbar/Toast للرسائل الفورية بأسلوب النصوص الافتراضية والألوان الافتراضية.
- حالات Empty/Loading/Errors لكل قائمة.
- حالة فارغة لسجل المحادثات مع رسالة واضحة وزر مسح المرشحات.
- رسائل خطأ واضحة عند فشل البحث أو التصفية.
- رسائل تأكيد عند حذف أو أرشفة المحادثات.
- رسائل خطأ واضحة عند فشل تحميل الخطوط أو الأيقونات.
- مراقبة أعطال (Crashlytics لاحقاً بصورة اختيارية بعد موافقة المستخدم).

### 18) التسمية والأنماط النصية
- مفاتيح ترجمة دلالية في نظام ARB مثل: `chatNew`, `foldersCreate`, `settingsGeneralLanguage`, `chatHistorySearchPlaceholder`, `chatHistoryFilterAll`.
- استخدام نصوص مختصرة ومباشرة، عربية فصيحة مبسطة.
- تنسيق تواريخ المحادثات حسب المنطقة الزمنية المختارة.
- عرض عدد الرسائل بصيغة "X رسالة" مع دعم الجمع في العربية.
- رسائل تأكيد واضحة للحذف والأرشفة في سجل المحادثات.
- استخدام IBM Plex Sans Arabic بجميع الأوزان حسب السياق (عنوان، نص، توضيح).

### 19) التنقل وتبديل السياق
- شريط سفلي للتنقل غير مطلوب؛ الارتكاز على شاشة محادثة واحدة وشريط جانبي كـ Drawer.
- الانتقال إلى الإعدادات/المساعدة/الملاحظات عبر AppBar Actions وDrawer.
- الانتقال إلى سجل المحادثات من الشريط الجانبي أو من زر في AppBar.
- العودة من سجل المحادثات إلى المحادثة الرئيسية عبر زر "العودة للمحادثة".
- حفظ حالة البحث والتصفية عند التنقل بين الشاشات.

### 20) خطة الأنيميشن
- Splash: مسارات نقاط/نبض يرمز للشبكات العصبية مع FontAwesome 7 أيقونات متحركة.
- Login: انتقالات Slide/Scale بين المرحلتين مع IBM Plex Sans Arabic.
- Chat: مؤشر كتابة، إدخال/خروج الرسائل، سحب عناصر القائمة للأرشفة والحذف.
- Chat History: انتقالات سلسة عند البحث والتصفية، تحميل تدريجي للعناصر، انتقالات الصفحات.
- Drawer: حركات انتباه خفيفة عند فتح القوائم الفرعية.
- Search: تأثيرات بصرية عند البحث مع مؤشر تحميل.
- Icons: انتقالات سلسة للأيقونات FontAwesome 7 عند التفاعل.

### 21) خارطة الطريق التقنية
- **المرحلة 0**: إعداد البنية الأساسية مع OOP، FontAwesome 7، IBM Plex Sans Arabic، ونظام ARB.
- **المرحلة 1**: واجهات بدون تكامل سحابي، تخزين محلي كامل، i18n، سمات Light/Dark، إدارة محادثات/مجلدات، شاشة سجل المحادثات مع البحث والتصفية.
- **المرحلة 2**: تصدير/مشاركة، إشعارات محلية، تسجيل صوتي، ترقيم الصفحات/تمرير لانهائي لسجل المحادثات.
- **المرحلة 3**: تكامل AI فعلي عبر API (عند توفره)، مزامنة سحابية، تحليلات اختيارية.
- **المرحلة 4**: تحسينات متقدمة لسجل المحادثات: بحث ذكي، تصنيف تلقائي، تحليلات الاستخدام.

### 22) متطلبات الحزم (اقتراح)
- الحالة والتنقل: `flutter_riverpod`, `go_router`
- التخزين: `hive`, `hive_flutter` أو `isar`
- الترجمة: `flutter_localizations`, `intl` مع نظام ARB فقط
- الأيقونات: `font_awesome_flutter` (FontAwesome 7 fa-regular)
- الخطوط: `google_fonts` لـ IBM Plex Sans Arabic بجميع الأوزان (100-900)
- المشاركة/التصدير: `share_plus`, توليد PDF لاحقاً `printing/pdf`
- الإشعارات: `flutter_local_notifications`
- الالتقاط/المعرض: `image_picker`
- البحث: `flutter_search_bar` أو `search_choices` للبحث المتقدم
- الترقيم: `pagination_view` أو `infinite_scroll_pagination`
- البحث المحلي: `flutter_search` أو `searchable_dropdown` للبحث في سجل المحادثات

#### متطلبات الخطوط والأيقونات:
```yaml
# pubspec.yaml
dependencies:
  google_fonts: ^6.1.0  # لـ IBM Plex Sans Arabic
  font_awesome_flutter: ^10.6.0  # FontAwesome 7 fa-regular

# استخدام الخطوط
fonts:
  - family: IBMPlexSansArabic
    fonts:
      - asset: assets/fonts/IBMPlexSansArabic-Thin.ttf
        weight: 100
      - asset: assets/fonts/IBMPlexSansArabic-ExtraLight.ttf
        weight: 200
      - asset: assets/fonts/IBMPlexSansArabic-Light.ttf
        weight: 300
      - asset: assets/fonts/IBMPlexSansArabic-Regular.ttf
        weight: 400
      - asset: assets/fonts/IBMPlexSansArabic-Medium.ttf
        weight: 500
      - asset: assets/fonts/IBMPlexSansArabic-SemiBold.ttf
        weight: 600
      - asset: assets/fonts/IBMPlexSansArabic-Bold.ttf
        weight: 700
      - asset: assets/fonts/IBMPlexSansArabic-ExtraBold.ttf
        weight: 800
      - asset: assets/fonts/IBMPlexSansArabic-Black.ttf
        weight: 900
```

### 23) معايير القبول (Acceptance Criteria) مختصرة
- **البرمجة الشيئية**: جميع المكونات تُصمم باستخدام OOP مع تطبيق مبادئ SOLID.
- **الأيقونات والخطوط**: استخدام FontAwesome 7 fa-regular و IBM Plex Sans Arabic بجميع الأوزان.
- **نظام الترجمة**: الاعتماد على نظام ARB فقط مع `flutter_localizations`.
- تبديل اللغة يحدّث الاتجاه والمحتوى فوراً.
- تبديل السمة فوري ويُحفظ في التخزين المحلي.
- إنشاء/إعادة تسمية/حذف مجلد وتغيير أيقونته يعملان عبر واجهات جوال سلسة.
- إضافة محادثة لمجلد/أرشفة/حذف عبر إيماءات وقوائم.
- شاشة سجل المحادثات تعرض قائمة المحادثات مع البحث والتصفية والترتيب.
- البحث في سجل المحادثات يعمل فورياً مع ترشيح النتائج.
- التصفية حسب النوع (جميع/أخيرة/مؤرشفة) تعمل بشكل صحيح.
- الترتيب حسب التاريخ/الاسم/عدد الرسائل يعمل بسلاسة.
- ترقيم الصفحات أو التمرير اللانهائي يعمل للمحادثات الكثيرة.
- أزرار الإجراءات (حذف/أرشفة/نقل/مشاركة) تعمل عبر قوائم منبثقة.
- حفظ حالة البحث والتصفية عند التنقل بين الشاشات.
- شاشة المساعدة تعرض الأقسام وتنتقل بينها.
- إرسال ملاحظة مع رفع صور (مع حدود الحجم/العدد) وتخزين محلي للمسوّدات.
- تسجيل الخروج يعيد المستخدم لشاشة الدخول ويمسح الجلسة المؤقتة.

### 24) ملاحظات الهوية البصرية
- استخدام أيقونة `kfu-icon` وشعار الجامعة من أصول SVG المرفقة.
- الحفاظ على الحياد اللوني مع إبراز اللون المؤسسي للعناصر التفاعلية.
- استخدام FontAwesome 7 fa-regular للمجلدات والإجراءات في سجل المحادثات.
- استخدام IBM Plex Sans Arabic بجميع الأوزان (100-900) للنصوص العربية.
- تنسيق موحد للشارات (Badges) لعرض عدد الرسائل في كل محادثة.
- تصميم موحد لعناصر البحث والتصفية في سجل المحادثات.

### 25) أمثلة نصية للترجمات (عينات ARB)
```arb
{
  "appName": "مساعد كفو",
  "authLogin": "تسجيل الدخول",
  "authUsername": "الرقم الجامعي",
  "authPassword": "رمز المرور",
  "authNext": "التالي",
  "authPrevious": "السابق",
  "authEnter": "دخول",
  "chatNew": "محادثة جديدة",
  "chatTitleDefault": "مساعدة في الرياضيات",
  "chatClear": "مسح المحادثة",
  "chatExport": "تصدير المحادثة",
  "chatShare": "مشاركة",
  "chatTyping": "مساعد كفو يكتب...",
  "chatHistoryTitle": "سجل المحادثات",
  "chatHistorySearchPlaceholder": "ابحث في المحادثات...",
  "chatHistoryFilterAll": "جميع المحادثات",
  "chatHistoryFilterRecent": "المحادثات الأخيرة",
  "chatHistoryFilterArchived": "المحادثات المؤرشفة",
  "chatHistorySortBy": "ترتيب حسب",
  "chatHistorySortDateDesc": "الأحدث أولاً",
  "chatHistorySortDateAsc": "الأقدم أولاً",
  "chatHistorySortTitle": "الاسم",
  "chatHistorySortMessages": "عدد الرسائل",
  "chatHistoryRefresh": "تحديث",
  "chatHistoryToggleView": "تبديل العرض",
  "chatHistoryBackToChat": "العودة للمحادثة",
  "chatHistoryDelete": "حذف المحادثة",
  "chatHistoryArchive": "أرشفة",
  "chatHistoryMoveToFolder": "نقل إلى مجلد",
  "chatHistoryShare": "مشاركة",
  "chatHistoryEmptyState": "لا توجد محادثات",
  "chatHistoryClearFilters": "مسح المرشحات",
  "chatHistoryMessagesCount": "{count} رسالة",
  "chatHistoryConfirmDelete": "هل أنت متأكد من حذف هذه المحادثة؟",
  "chatHistoryConfirmArchive": "هل تريد أرشفة هذه المحادثة؟",
  "chatHistorySearchResults": "نتائج البحث: {count} محادثة"
}
```

### 26) ملاحظات ختامية
- هذا المستند هو مرجع تنفيذي لفريق فلاتر لتحويل تجربة الويب الحالية إلى تطبيق جوّال متقن، مع الحفاظ على الأسلوب البصري واللغوي، ودعم السمات وتعدد اللغات، وتهيئة بنية قابلة للتوسّع للتكامل مع خدمات الذكاء الاصطناعي لاحقاً.
- **البرمجة الشيئية (OOP)**: يجب الاعتماد الكامل على مبادئ البرمجة الشيئية في جميع خطوات التنفيذ، مع تطبيق مبادئ SOLID والتغليف والوراثة وتعدد الأشكال.
- **الأيقونات والخطوط**: استخدام FontAwesome 7 fa-regular للأيقونات و IBM Plex Sans Arabic بجميع الأوزان للنصوص العربية.
- **نظام الترجمة**: الاعتماد على نظام ARB فقط مع `flutter_localizations` و `intl` لضمان التوافق مع معايير Flutter.
- شاشة سجل المحادثات تعتبر مكوناً أساسياً في التطبيق، حيث تتيح للمستخدمين إدارة وتنظيم محادثاتهم بكفاءة، مع إمكانيات بحث وتصفية متقدمة.
- يجب التركيز على تجربة المستخدم السلسة في التنقل بين المحادثة الرئيسية وسجل المحادثات، مع الحفاظ على السياق والبيانات.
- البحث والتصفية في سجل المحادثات يجب أن يكون سريعاً ومتجاوباً، مع دعم البحث في النصوص والتصفية حسب المجلدات والتواريخ.
- ترقيم الصفحات أو التمرير اللانهائي يجب أن يعمل بسلاسة للمحادثات الكثيرة، مع تحميل تدريجي للعناصر.
- أزرار الإجراءات (حذف/أرشفة/نقل/مشاركة) يجب أن تعمل عبر قوائم منبثقة واضحة، مع رسائل تأكيد للحذف والأرشفة.
- حفظ حالة البحث والتصفية عند التنقل بين الشاشات لتحسين تجربة المستخدم.
- دعم البحث المحلي السريع مع فهرسة النصوص وتحسين الأداء للمحادثات الكثيرة.
- إدارة حالة البحث والتصفية مع حفظ التفضيلات في التخزين المحلي.
- دعم البحث المتقدم مع ترشيح النتائج وعرض عدد النتائج المطابقة.


