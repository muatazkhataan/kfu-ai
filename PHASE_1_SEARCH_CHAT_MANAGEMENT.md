# ğŸ” Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: Ø§Ù„Ø¨Ø­Ø« ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª - Ø®Ø·Ø© ØªÙØµÙŠÙ„ÙŠØ©

## ğŸ“Š Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©

**Ø§Ù„Ù‡Ø¯Ù:** ØªØ·ÙˆÙŠØ± Ù†Ø¸Ø§Ù… Ø¨Ø­Ø« Ù…ØªÙ‚Ø¯Ù… ÙˆØ¥Ø¯Ø§Ø±Ø© ÙƒØ§Ù…Ù„Ø© Ù„Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª

**Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:** 4-5 Ø£ÙŠØ§Ù…

**Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©:** ğŸ”´ Ø¹Ø§Ù„ÙŠØ© Ø¬Ø¯Ø§Ù‹

---

## ğŸ¯ Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©

### 1ï¸âƒ£ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª

#### âœ… Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©:
- [x] Ø²Ø± Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© (Ù…ÙˆØ¬ÙˆØ¯)
- [ ] Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ÙƒØ§Ù…Ù„Ø©
- [ ] Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰
- [ ] Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù…Ø¹ ØªÙ…ÙŠÙŠØ² Ø§Ù„ÙƒÙ„Ù…Ø§Øª
- [ ] ÙÙ„ØªØ±Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ (Ø§Ù„Ù…Ø¬Ù„Ø¯ØŒ Ø§Ù„ØªØ§Ø±ÙŠØ®)

#### âœ… Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©:
- [ ] Ø­ÙØ¸ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø­Ø«
- [ ] Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
- [ ] Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ØµÙˆØªÙŠ (Ù…Ø³ØªÙ‚Ø¨Ù„Ø§Ù‹)

---

### 2ï¸âƒ£ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª

#### âœ… Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:
- [ ] Ø£Ø±Ø´ÙØ© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
- [ ] Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù…Ù† Ø§Ù„Ø£Ø±Ø´ÙŠÙ
- [ ] Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
- [ ] Ù†Ù‚Ù„ Ø¥Ù„Ù‰ Ù…Ø¬Ù„Ø¯
- [ ] ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
- [ ] Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©

---

## ğŸ—ï¸ Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©

### ğŸ“ Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ù…Ù„ÙØ§Øª:

```
lib/features/search/
  â”œâ”€â”€ data/
  â”‚   â”œâ”€â”€ repositories/
  â”‚   â”‚   â””â”€â”€ search_repository_impl.dart
  â”‚   â””â”€â”€ data_sources/
  â”‚       â””â”€â”€ search_remote_data_source.dart
  â”‚
  â”œâ”€â”€ domain/
  â”‚   â”œâ”€â”€ models/
  â”‚   â”‚   â”œâ”€â”€ search_result.dart
  â”‚   â”‚   â”œâ”€â”€ search_filter.dart
  â”‚   â”‚   â””â”€â”€ search_history_item.dart
  â”‚   â””â”€â”€ repositories/
  â”‚       â””â”€â”€ search_repository.dart
  â”‚
  â””â”€â”€ presentation/
      â”œâ”€â”€ providers/
      â”‚   â”œâ”€â”€ search_provider.dart
      â”‚   â”œâ”€â”€ search_filter_provider.dart
      â”‚   â””â”€â”€ search_history_provider.dart
      â”‚
      â”œâ”€â”€ screens/
      â”‚   â””â”€â”€ search_screen.dart
      â”‚
      â””â”€â”€ widgets/
          â”œâ”€â”€ search_bar_widget.dart
          â”œâ”€â”€ search_results_list.dart
          â”œâ”€â”€ search_result_item.dart
          â”œâ”€â”€ search_filter_sheet.dart
          â”œâ”€â”€ search_history_list.dart
          â””â”€â”€ empty_search_state.dart

lib/features/chat/presentation/
  â””â”€â”€ widgets/
      â”œâ”€â”€ chat_options_menu.dart
      â”œâ”€â”€ chat_action_button.dart
      â”œâ”€â”€ delete_confirmation_dialog.dart
      â”œâ”€â”€ archive_confirmation_dialog.dart
      â”œâ”€â”€ move_to_folder_sheet.dart
      â””â”€â”€ edit_title_dialog.dart
```

---

## ğŸ“ Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©

### **Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø¥Ù†Ø´Ø§Ø¡ Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø¨Ø­Ø« (Models)**

#### 1.1 SearchResult Model
```dart
// lib/features/search/domain/models/search_result.dart

class SearchResult {
  final String sessionId;
  final String title;
  final String snippet;          // Ù…Ù‚ØªØ·Ù Ù…Ù† Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
  final String? folderName;
  final DateTime createdAt;
  final int messageCount;
  final List<String> highlightedWords; // Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ù…ÙŠØ²Ø©
  
  // Constructor, fromJson, toJson
}
```

#### 1.2 SearchFilter Model
```dart
// lib/features/search/domain/models/search_filter.dart

class SearchFilter {
  final String? folderId;
  final DateTime? startDate;
  final DateTime? endDate;
  final SearchType type; // all, archived, unarchived
  final SortBy sortBy;   // date, relevance, title
  
  // Constructor, copyWith, toMap
}
```

#### 1.3 SearchHistoryItem Model
```dart
// lib/features/search/domain/models/search_history_item.dart

class SearchHistoryItem {
  final String query;
  final DateTime timestamp;
  final int resultCount;
  
  // Constructor, fromJson, toJson
}
```

**â±ï¸ Ø§Ù„ÙˆÙ‚Øª:** 1-2 Ø³Ø§Ø¹Ø©

---

### **Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø¥Ù†Ø´Ø§Ø¡ Repository Ùˆ Data Source**

#### 2.1 SearchRepository (Interface)
```dart
// lib/features/search/domain/repositories/search_repository.dart

abstract class SearchRepository {
  Future<List<SearchResult>> searchChats(String query, SearchFilter? filter);
  Future<List<String>> getSearchSuggestions(String query);
  Future<List<SearchHistoryItem>> getSearchHistory();
  Future<void> saveSearchHistory(String query, int resultCount);
  Future<void> clearSearchHistory();
}
```

#### 2.2 SearchRemoteDataSource
```dart
// lib/features/search/data/data_sources/search_remote_data_source.dart

class SearchRemoteDataSource {
  final ApiManager _apiManager;
  
  Future<List<SearchResultDto>> searchChats(
    String query, 
    Map<String, dynamic> filters,
  ) async {
    // Ø§Ø³ØªØ®Ø¯Ø§Ù…: /api/Search/SearchChats
    final response = await _apiManager.search.searchChats(
      query: query,
      filters: filters,
    );
    return response;
  }
}
```

#### 2.3 SearchRepositoryImpl
```dart
// lib/features/search/data/repositories/search_repository_impl.dart

class SearchRepositoryImpl implements SearchRepository {
  final SearchRemoteDataSource _remoteDataSource;
  final LocalStorageService _localStorage;
  
  @override
  Future<List<SearchResult>> searchChats(
    String query, 
    SearchFilter? filter,
  ) async {
    // ØªÙ†ÙÙŠØ° Ø§Ù„Ø¨Ø­Ø«
    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬
    // Ø­ÙØ¸ ÙÙŠ Ø§Ù„ØªØ§Ø±ÙŠØ®
  }
  
  // ØªÙ†ÙÙŠØ° Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¯ÙˆØ§Ù„...
}
```

**â±ï¸ Ø§Ù„ÙˆÙ‚Øª:** 2-3 Ø³Ø§Ø¹Ø§Øª

---

### **Ø§Ù„Ø®Ø·ÙˆØ© 3: Ø¥Ù†Ø´Ø§Ø¡ Providers**

#### 3.1 SearchProvider
```dart
// lib/features/search/presentation/providers/search_provider.dart

@riverpod
class Search extends _$Search {
  @override
  AsyncValue<List<SearchResult>> build() {
    return const AsyncValue.data([]);
  }
  
  Future<void> search(String query) async {
    state = const AsyncValue.loading();
    
    try {
      final results = await ref
          .read(searchRepositoryProvider)
          .searchChats(query, null);
          
      state = AsyncValue.data(results);
      
      // Ø­ÙØ¸ ÙÙŠ Ø§Ù„ØªØ§Ø±ÙŠØ®
      await _saveToHistory(query, results.length);
    } catch (e, st) {
      state = AsyncValue.error(e, st);
    }
  }
  
  Future<void> searchWithFilter(
    String query, 
    SearchFilter filter,
  ) async {
    // Ø§Ù„Ø¨Ø­Ø« Ù…Ø¹ Ø§Ù„ÙÙ„ØªØ±
  }
}
```

#### 3.2 SearchFilterProvider
```dart
// lib/features/search/presentation/providers/search_filter_provider.dart

@riverpod
class SearchFilterNotifier extends _$SearchFilterNotifier {
  @override
  SearchFilter build() {
    return SearchFilter(
      type: SearchType.all,
      sortBy: SortBy.relevance,
    );
  }
  
  void updateFilter(SearchFilter newFilter) {
    state = newFilter;
  }
  
  void resetFilter() {
    state = SearchFilter(
      type: SearchType.all,
      sortBy: SortBy.relevance,
    );
  }
}
```

#### 3.3 SearchHistoryProvider
```dart
// lib/features/search/presentation/providers/search_history_provider.dart

@riverpod
class SearchHistory extends _$SearchHistory {
  @override
  Future<List<SearchHistoryItem>> build() async {
    return await ref
        .read(searchRepositoryProvider)
        .getSearchHistory();
  }
  
  Future<void> clearHistory() async {
    await ref
        .read(searchRepositoryProvider)
        .clearSearchHistory();
        
    ref.invalidateSelf();
  }
}
```

**â±ï¸ Ø§Ù„ÙˆÙ‚Øª:** 2-3 Ø³Ø§Ø¹Ø§Øª

---

### **Ø§Ù„Ø®Ø·ÙˆØ© 4: Ø¥Ù†Ø´Ø§Ø¡ Widgets**

#### 4.1 SearchBarWidget
```dart
// lib/features/search/presentation/widgets/search_bar_widget.dart

class SearchBarWidget extends ConsumerStatefulWidget {
  final Function(String) onSearch;
  final Function(String) onChanged;
  
  // TextField Ù…Ø¹:
  // - Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¨Ø­Ø«
  // - Ø²Ø± Ù…Ø³Ø­
  // - Auto-focus
  // - Submit on enter
}
```

#### 4.2 SearchResultItem
```dart
// lib/features/search/presentation/widgets/search_result_item.dart

class SearchResultItem extends StatelessWidget {
  final SearchResult result;
  final List<String> highlightedWords;
  
  // Ø¹Ø±Ø¶:
  // - Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù…Ø¹ highlight
  // - Ø§Ù„Ù…Ù‚ØªØ·Ù Ù…Ø¹ highlight
  // - Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù„Ø¯
  // - Ø§Ù„ØªØ§Ø±ÙŠØ®
  // - Ø¹Ø¯Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
  // - Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø³Ù‡Ù…
}
```

#### 4.3 SearchFilterSheet
```dart
// lib/features/search/presentation/widgets/search_filter_sheet.dart

class SearchFilterSheet extends ConsumerWidget {
  // Bottom sheet Ù…Ø¹:
  // - Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø¬Ù„Ø¯
  // - Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø²Ù…Ù†ÙŠ
  // - Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù†ÙˆØ¹ (Ø§Ù„ÙƒÙ„ØŒ Ø§Ù„Ù…Ø¤Ø±Ø´ÙØŒ ØºÙŠØ± Ø§Ù„Ù…Ø¤Ø±Ø´Ù)
  // - Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØ±ØªÙŠØ¨
  // - Ø²Ø± ØªØ·Ø¨ÙŠÙ‚
  // - Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
}
```

#### 4.4 SearchHistoryList
```dart
// lib/features/search/presentation/widgets/search_history_list.dart

class SearchHistoryList extends ConsumerWidget {
  final Function(String) onHistoryItemTap;
  
  // Ø¹Ø±Ø¶:
  // - Ù‚Ø§Ø¦Ù…Ø© ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø­Ø«
  // - Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø³Ø§Ø¹Ø© Ù„ÙƒÙ„ Ø¹Ù†ØµØ±
  // - Ø¹Ø¯Ø¯ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
  // - Ø²Ø± Ø­Ø°Ù Ù„ÙƒÙ„ Ø¹Ù†ØµØ±
  // - Ø²Ø± Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„
}
```

#### 4.5 EmptySearchState
```dart
// lib/features/search/presentation/widgets/empty_search_state.dart

class EmptySearchState extends StatelessWidget {
  final String? query;
  
  // Ø¹Ø±Ø¶:
  // - Ø±Ø³Ø§Ù„Ø© "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬" Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ query
  // - Ø±Ø³Ø§Ù„Ø© "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¨Ø­Ø«" Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ query
  // - Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù…Ù†Ø§Ø³Ø¨Ø©
  // - Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª
}
```

**â±ï¸ Ø§Ù„ÙˆÙ‚Øª:** 3-4 Ø³Ø§Ø¹Ø§Øª

---

### **Ø§Ù„Ø®Ø·ÙˆØ© 5: Ø¥Ù†Ø´Ø§Ø¡ SearchScreen**

#### 5.1 SearchScreen
```dart
// lib/features/search/presentation/screens/search_screen.dart

class SearchScreen extends ConsumerStatefulWidget {
  @override
  ConsumerState<SearchScreen> createState() => _SearchScreenState();
}

class _SearchScreenState extends ConsumerState<SearchScreen> {
  late TextEditingController _searchController;
  late FocusNode _searchFocusNode;
  
  @override
  void initState() {
    super.initState();
    _searchController = TextEditingController();
    _searchFocusNode = FocusNode();
    _searchFocusNode.requestFocus();
  }
  
  @override
  Widget build(BuildContext context) {
    final searchResults = ref.watch(searchProvider);
    final searchHistory = ref.watch(searchHistoryProvider);
    final currentFilter = ref.watch(searchFilterProvider);
    
    return Scaffold(
      appBar: _buildAppBar(),
      body: Column(
        children: [
          // Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø«
          SearchBarWidget(
            controller: _searchController,
            focusNode: _searchFocusNode,
            onSearch: _onSearch,
            onChanged: _onSearchChanged,
          ),
          
          // Ø²Ø± Ø§Ù„ÙÙ„ØªØ±
          _buildFilterButton(),
          
          // Ø§Ù„Ù…Ø­ØªÙˆÙ‰
          Expanded(
            child: searchResults.when(
              data: (results) {
                if (results.isEmpty) {
                  return _buildEmptyState();
                }
                return SearchResultsList(results: results);
              },
              loading: () => _buildLoadingState(),
              error: (error, stack) => _buildErrorState(error),
            ),
          ),
        ],
      ),
    );
  }
  
  PreferredSizeWidget _buildAppBar() {
    return AppBar(
      title: const Text('Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª'),
      actions: [
        IconButton(
          icon: Icon(AppIcons.getIcon(AppIcon.filter)),
          onPressed: _showFilterSheet,
        ),
      ],
    );
  }
  
  Widget _buildFilterButton() {
    final filter = ref.watch(searchFilterProvider);
    final hasActiveFilter = filter.folderId != null ||
        filter.startDate != null ||
        filter.type != SearchType.all;
        
    return Padding(
      padding: const EdgeInsets.all(12),
      child: Row(
        children: [
          if (hasActiveFilter)
            Chip(
              label: const Text('Ø§Ù„ÙÙ„ØªØ± Ù†Ø´Ø·'),
              deleteIcon: const Icon(Icons.close, size: 16),
              onDeleted: () {
                ref.read(searchFilterProvider.notifier).resetFilter();
                _onSearch(_searchController.text);
              },
            ),
        ],
      ),
    );
  }
  
  Widget _buildEmptyState() {
    if (_searchController.text.isEmpty) {
      // Ø¹Ø±Ø¶ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø­Ø«
      return SearchHistoryList(
        onHistoryItemTap: (query) {
          _searchController.text = query;
          _onSearch(query);
        },
      );
    } else {
      // Ø¹Ø±Ø¶ "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬"
      return EmptySearchState(query: _searchController.text);
    }
  }
  
  void _onSearch(String query) {
    if (query.isEmpty) return;
    
    final filter = ref.read(searchFilterProvider);
    ref.read(searchProvider.notifier).searchWithFilter(query, filter);
  }
  
  void _onSearchChanged(String query) {
    // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© debounce Ù„Ù„Ø¨Ø­Ø« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
  }
  
  void _showFilterSheet() {
    showModalBottomSheet(
      context: context,
      builder: (context) => SearchFilterSheet(
        currentFilter: ref.read(searchFilterProvider),
        onApply: (newFilter) {
          ref.read(searchFilterProvider.notifier).updateFilter(newFilter);
          _onSearch(_searchController.text);
          Navigator.pop(context);
        },
      ),
    );
  }
}
```

**â±ï¸ Ø§Ù„ÙˆÙ‚Øª:** 2-3 Ø³Ø§Ø¹Ø§Øª

---

### **Ø§Ù„Ø®Ø·ÙˆØ© 6: Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª - Widgets**

#### 6.1 ChatOptionsMenu
```dart
// lib/features/chat/presentation/widgets/chat_options_menu.dart

class ChatOptionsMenu extends ConsumerWidget {
  final String sessionId;
  final String sessionTitle;
  final bool isArchived;
  
  @override
  Widget build(BuildContext context, WidgetRef ref) {
    return PopupMenuButton<ChatAction>(
      icon: Icon(AppIcons.getIcon(AppIcon.moreVert)),
      onSelected: (action) => _handleAction(action, context, ref),
      itemBuilder: (context) => [
        PopupMenuItem(
          value: ChatAction.rename,
          child: Row(
            children: [
              Icon(AppIcons.getIcon(AppIcon.edit)),
              const SizedBox(width: 8),
              const Text('ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†'),
            ],
          ),
        ),
        PopupMenuItem(
          value: ChatAction.moveToFolder,
          child: Row(
            children: [
              Icon(AppIcons.getIcon(AppIcon.folder)),
              const SizedBox(width: 8),
              const Text('Ù†Ù‚Ù„ Ø¥Ù„Ù‰ Ù…Ø¬Ù„Ø¯'),
            ],
          ),
        ),
        if (!isArchived)
          PopupMenuItem(
            value: ChatAction.archive,
            child: Row(
              children: [
                Icon(AppIcons.getIcon(AppIcon.archive)),
                const SizedBox(width: 8),
                const Text('Ø£Ø±Ø´ÙØ©'),
              ],
            ),
          )
        else
          PopupMenuItem(
            value: ChatAction.restore,
            child: Row(
              children: [
                Icon(AppIcons.getIcon(AppIcon.unarchive)),
                const SizedBox(width: 8),
                const Text('Ø§Ø³ØªØ¹Ø§Ø¯Ø©'),
              ],
            ),
          ),
        const PopupMenuDivider(),
        PopupMenuItem(
          value: ChatAction.delete,
          child: Row(
            children: [
              Icon(
                AppIcons.getIcon(AppIcon.delete),
                color: context.colorScheme.error,
              ),
              const SizedBox(width: 8),
              Text(
                'Ø­Ø°Ù',
                style: TextStyle(color: context.colorScheme.error),
              ),
            ],
          ),
        ),
      ],
    );
  }
  
  Future<void> _handleAction(
    ChatAction action,
    BuildContext context,
    WidgetRef ref,
  ) async {
    switch (action) {
      case ChatAction.rename:
        await _showRenameDialog(context, ref);
        break;
      case ChatAction.moveToFolder:
        await _showMoveToFolderSheet(context, ref);
        break;
      case ChatAction.archive:
        await _archiveChat(context, ref);
        break;
      case ChatAction.restore:
        await _restoreChat(context, ref);
        break;
      case ChatAction.delete:
        await _showDeleteDialog(context, ref);
        break;
    }
  }
}
```

#### 6.2 EditTitleDialog
```dart
// lib/features/chat/presentation/widgets/edit_title_dialog.dart

class EditTitleDialog extends StatefulWidget {
  final String currentTitle;
  final Function(String) onSave;
  
  // Dialog Ù…Ø¹:
  // - TextField Ù„Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯
  // - Ø²Ø± Ø­ÙØ¸
  // - Ø²Ø± Ø¥Ù„ØºØ§Ø¡
  // - Validation
}
```

#### 6.3 MoveToFolderSheet
```dart
// lib/features/chat/presentation/widgets/move_to_folder_sheet.dart

class MoveToFolderSheet extends ConsumerWidget {
  final String sessionId;
  final String? currentFolderId;
  
  // Bottom sheet Ù…Ø¹:
  // - Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª
  // - Ø®ÙŠØ§Ø± "Ø¨Ø¯ÙˆÙ† Ù…Ø¬Ù„Ø¯"
  // - ØªÙ…ÙŠÙŠØ² Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠ
  // - Ø²Ø± Ù†Ù‚Ù„
}
```

#### 6.4 DeleteConfirmationDialog
```dart
// lib/features/chat/presentation/widgets/delete_confirmation_dialog.dart

class DeleteConfirmationDialog extends StatelessWidget {
  final String sessionTitle;
  final VoidCallback onConfirm;
  
  // Dialog ØªØ£ÙƒÙŠØ¯ Ù…Ø¹:
  // - Ø±Ø³Ø§Ù„Ø© ØªØ­Ø°ÙŠØ±ÙŠØ©
  // - Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
  // - Ø²Ø± Ø­Ø°Ù (Ø£Ø­Ù…Ø±)
  // - Ø²Ø± Ø¥Ù„ØºØ§Ø¡
}
```

**â±ï¸ Ø§Ù„ÙˆÙ‚Øª:** 3-4 Ø³Ø§Ø¹Ø§Øª

---

### **Ø§Ù„Ø®Ø·ÙˆØ© 7: Ø¥Ø¶Ø§ÙØ© Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙÙŠ ChatProvider**

```dart
// ØªØ­Ø¯ÙŠØ« lib/features/chat/presentation/providers/chat_provider.dart

class ChatNotifier extends StateNotifier<ChatState> {
  // ... existing code ...
  
  /// Ø£Ø±Ø´ÙØ© Ù…Ø­Ø§Ø¯Ø«Ø©
  Future<void> archiveChat(String sessionId) async {
    try {
      await _apiManager.chat.archiveSession(sessionId);
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ©
      state = state.copyWith(
        recentChats: state.recentChats
            .where((chat) => chat.id != sessionId)
            .toList(),
      );
      
      _showSuccessMessage('ØªÙ… Ø£Ø±Ø´ÙØ© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø¨Ù†Ø¬Ø§Ø­');
    } catch (e) {
      _showErrorMessage('ÙØ´Ù„ Ø£Ø±Ø´ÙØ© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©: $e');
    }
  }
  
  /// Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ù† Ø§Ù„Ø£Ø±Ø´ÙŠÙ
  Future<void> restoreChat(String sessionId) async {
    try {
      await _apiManager.chat.restoreSession(sessionId);
      
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª
      await loadRecentChats();
      
      _showSuccessMessage('ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø¨Ù†Ø¬Ø§Ø­');
    } catch (e) {
      _showErrorMessage('ÙØ´Ù„ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©: $e');
    }
  }
  
  /// Ø­Ø°Ù Ù…Ø­Ø§Ø¯Ø«Ø©
  Future<void> deleteChat(String sessionId) async {
    try {
      await _apiManager.chat.deleteSession(sessionId);
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ©
      state = state.copyWith(
        recentChats: state.recentChats
            .where((chat) => chat.id != sessionId)
            .toList(),
      );
      
      _showSuccessMessage('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø¨Ù†Ø¬Ø§Ø­');
    } catch (e) {
      _showErrorMessage('ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©: $e');
    }
  }
  
  /// Ù†Ù‚Ù„ Ù…Ø­Ø§Ø¯Ø«Ø© Ø¥Ù„Ù‰ Ù…Ø¬Ù„Ø¯
  Future<void> moveChatToFolder(String sessionId, String folderId) async {
    try {
      await _apiManager.chat.moveSessionToFolder(sessionId, folderId);
      
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª
      await loadRecentChats();
      
      _showSuccessMessage('ØªÙ… Ù†Ù‚Ù„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø¨Ù†Ø¬Ø§Ø­');
    } catch (e) {
      _showErrorMessage('ÙØ´Ù„ Ù†Ù‚Ù„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©: $e');
    }
  }
  
  /// ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù†ÙˆØ§Ù† Ù…Ø­Ø§Ø¯Ø«Ø©
  Future<void> updateChatTitle(String sessionId, String newTitle) async {
    try {
      await _apiManager.chat.updateSessionTitle(sessionId, newTitle);
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ©
      state = state.copyWith(
        recentChats: state.recentChats.map((chat) {
          if (chat.id == sessionId) {
            return chat.copyWith(title: newTitle);
          }
          return chat;
        }).toList(),
      );
      
      _showSuccessMessage('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ù†Ø¬Ø§Ø­');
    } catch (e) {
      _showErrorMessage('ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: $e');
    }
  }
}
```

**â±ï¸ Ø§Ù„ÙˆÙ‚Øª:** 2 Ø³Ø§Ø¹Ø©

---

### **Ø§Ù„Ø®Ø·ÙˆØ© 8: ØªØ­Ø¯ÙŠØ« ChatScreen Ù„Ø¥Ø¶Ø§ÙØ© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª**

```dart
// ØªØ­Ø¯ÙŠØ« lib/features/chat/presentation/screens/chat_screen.dart

// ÙÙŠ _buildChatList Ùˆ _buildRecentChatsSection:

ListTile(
  // ... existing properties ...
  trailing: ChatOptionsMenu(
    sessionId: chat.id,
    sessionTitle: chat.title,
    isArchived: chat.isArchived,
  ),
)
```

**â±ï¸ Ø§Ù„ÙˆÙ‚Øª:** 30 Ø¯Ù‚ÙŠÙ‚Ø©

---

### **Ø§Ù„Ø®Ø·ÙˆØ© 9: Ø±Ø¨Ø· Ø²Ø± Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©**

```dart
// ØªØ­Ø¯ÙŠØ« lib/features/chat/presentation/screens/chat_screen.dart

// ÙÙŠ Ø²Ø± Ø§Ù„Ø¨Ø­Ø«:
OutlinedButton.icon(
  onPressed: () {
    Navigator.pop(context);
    Navigator.push(
      context,
      MaterialPageRoute(
        builder: (context) => const SearchScreen(),
      ),
    );
  },
  icon: Icon(AppIcons.getIcon(AppIcon.search), size: 16),
  label: const Text('Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª'),
  // ... existing style ...
),
```

**â±ï¸ Ø§Ù„ÙˆÙ‚Øª:** 15 Ø¯Ù‚ÙŠÙ‚Ø©

---

### **Ø§Ù„Ø®Ø·ÙˆØ© 10: ØªØ­Ø¯ÙŠØ« API Service**

```dart
// ØªØ­Ø¯ÙŠØ« lib/services/api/search/search_api_service.dart (Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹)

class SearchApiService {
  final ApiClient _client;
  
  SearchApiService(this._client);
  
  /// Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª
  Future<ApiResponse<List<SearchResultDto>>> searchChats({
    required String query,
    String? folderId,
    DateTime? startDate,
    DateTime? endDate,
    String? type,
    String? sortBy,
    int page = 1,
    int pageSize = 20,
  }) async {
    final queryParams = {
      'query': query,
      'page': page,
      'pageSize': pageSize,
      if (folderId != null) 'folderId': folderId,
      if (startDate != null) 'startDate': startDate.toIso8601String(),
      if (endDate != null) 'endDate': endDate.toIso8601String(),
      if (type != null) 'type': type,
      if (sortBy != null) 'sortBy': sortBy,
    };
    
    return _client.get(
      '/api/Search/SearchChats',
      queryParameters: queryParams,
      fromJson: (json) => (json as List)
          .map((item) => SearchResultDto.fromJson(item))
          .toList(),
    );
  }
}
```

**â±ï¸ Ø§Ù„ÙˆÙ‚Øª:** 1 Ø³Ø§Ø¹Ø©

---

## âœ… Checklist Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ

### Ù‚Ø¨Ù„ Ø§Ù„Ø¨Ø¯Ø¡:
- [ ] Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¬Ù…ÙŠØ¹ API endpoints Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
- [ ] Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªÙˆÙØ± Ø§Ù„Ù€ tokens ÙˆØ§Ù„Ù€ permissions
- [ ] Ø¥Ù†Ø´Ø§Ø¡ branch Ø¬Ø¯ÙŠØ¯ ÙÙŠ Git

### Ø®Ù„Ø§Ù„ Ø§Ù„ØªØ·ÙˆÙŠØ±:
- [ ] Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù€ models
- [ ] Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù€ repository ÙˆØ§Ù„Ù€ data source
- [ ] Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù€ providers
- [ ] Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù€ widgets
- [ ] Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù€ screens
- [ ] Ø±Ø¨Ø· ÙƒÙ„ Ø´ÙŠØ¡ Ù…Ø¹Ø§Ù‹
- [ ] Ø§Ø®ØªØ¨Ø§Ø± ÙƒÙ„ Ù…ÙŠØ²Ø© Ø¹Ù„Ù‰ Ø­Ø¯Ø©

### Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡:
- [ ] Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙŠØ²Ø§Øª
- [ ] Ø§Ø®ØªØ¨Ø§Ø± Ø¹Ù„Ù‰ Ø£Ø¬Ù‡Ø²Ø© Ù…Ø®ØªÙ„ÙØ©
- [ ] Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ÙƒÙˆØ¯
- [ ] ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
- [ ] Commit & Push
- [ ] Ø¥Ù†Ø´Ø§Ø¡ Pull Request

---

## ğŸ§ª Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆÙ‡Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±

### Ø§Ù„Ø¨Ø­Ø«:
1. [ ] Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ÙÙ‚Ø·
2. [ ] Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø­ØªÙˆÙ‰
3. [ ] Ø§Ù„Ø¨Ø­Ø« Ø¨Ø¯ÙˆÙ† Ù†ØªØ§Ø¦Ø¬
4. [ ] Ø§Ù„Ø¨Ø­Ø« Ù…Ø¹ ÙÙ„ØªØ± Ø§Ù„Ù…Ø¬Ù„Ø¯
5. [ ] Ø§Ù„Ø¨Ø­Ø« Ù…Ø¹ ÙÙ„ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ®
6. [ ] Ø­ÙØ¸ ÙˆØ¹Ø±Ø¶ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø­Ø«
7. [ ] Ù…Ø³Ø­ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø­Ø«

### Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª:
1. [ ] Ø£Ø±Ø´ÙØ© Ù…Ø­Ø§Ø¯Ø«Ø©
2. [ ] Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¤Ø±Ø´ÙØ©
3. [ ] Ø­Ø°Ù Ù…Ø­Ø§Ø¯Ø«Ø©
4. [ ] ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù
5. [ ] Ù†Ù‚Ù„ Ù…Ø­Ø§Ø¯Ø«Ø© Ø¥Ù„Ù‰ Ù…Ø¬Ù„Ø¯
6. [ ] ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
7. [ ] Ø¹Ø±Ø¶ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­/Ø§Ù„ÙØ´Ù„

---

## ğŸ“Š Ø§Ù„Ù…Ù‚Ø§ÙŠÙŠØ³ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©

- **Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:** ~25 Ù…Ù„Ù
- **Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø·Ø± Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©:** ~2000-2500 Ø³Ø·Ø±
- **Ø¹Ø¯Ø¯ Ø§Ù„Ù€ Widgets:** ~15 widget
- **Ø¹Ø¯Ø¯ Ø§Ù„Ù€ Providers:** 5-6 providers
- **Ø¹Ø¯Ø¯ Ø§Ù„Ù€ Models:** 4-5 models

---

## ğŸš€ Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ù† Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1

### âœ… Ù…Ø§ Ø³ÙŠØªÙ… Ø¥Ù†Ø¬Ø§Ø²Ù‡:
- Ù†Ø¸Ø§Ù… Ø¨Ø­Ø« Ù…ØªÙ‚Ø¯Ù… ÙˆÙƒØ§Ù…Ù„
- Ø¥Ø¯Ø§Ø±Ø© Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª
- ØªØ¬Ø±Ø¨Ø© Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø­Ø³Ù‘Ù†Ø©
- Ù‚Ø§Ø¹Ø¯Ø© Ù‚ÙˆÙŠØ© Ù„Ù„Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©

### â¡ï¸ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„ØªØ§Ù„ÙŠØ©:
- Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ **Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2: Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª**

---

**ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡:** 2025-10-21
**âœï¸ Ø§Ù„Ø¥ØµØ¯Ø§Ø±:** 1.0
**ğŸ¯ Ø§Ù„Ø­Ø§Ù„Ø©:** Ø¬Ø§Ù‡Ø² Ù„Ù„ØªÙ†ÙÙŠØ°

