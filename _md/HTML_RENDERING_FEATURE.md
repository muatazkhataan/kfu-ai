# โจ ููุฒุฉ ุนุฑุถ ุฑุณุงุฆู HTML ูุน ุงููุตุงุฏุฑ

## ๐ ุงูููุฎุต

ุชู ุฅุถุงูุฉ ูุธุงู ูุงูู ูุนุฑุถ ุฑุณุงุฆู ุงููุณุงุนุฏ ุงูุชู ุชุฃุชู ุจุตูุบุฉ **HTML** ูุน ุงุณุชุฎุฑุงุฌ ูุนุฑุถ **ุงููุตุงุฏุฑ** ุจุฃููููุงุช FontAwesome ุฌูููุฉ.

---

## ๐ฏ ุงููุดููุฉ ุงูุฃุตููุฉ

ุฑุณุงุฆู ุงููุณุงุนุฏ ุชุฃุชู ูู ุงูุฎุงุฏู ุจุตูุบุฉ HTML:

```html
<p>ููุฑุฑ ููุฏูุฉ ูู ุงูุฅุฑุดุงุฏ ุงูุณูุงุญู ูุชูุงูู ุชุนุฑูู ุงูุฅุฑุดุงุฏ ุงูุณูุงุญู...</p>
<p>ุจุดูู ุนุงูุ ููุฏู ุงูููุฑุฑ ุฅูู ุชุฃููู ุงูุทูุงุจ...</p>
<div class='sources mt-4'>
  <p class='text-primary'><strong>ุงููุตุงุฏุฑ</strong></p>
  <button type='button' class='btn btn-sm btn-light' data-toggle='popover' 
          title='ููุฏูุฉ ูู ุงูุงุฑุดุงุฏ ุงูุณูุงุญู-CH01-U03.pptx ุดุฑูุญุฉ ุฑูู : 2'>
    <i class='fa-duotone fa-light fa-file-ppt text-danger me-2'></i>
  </button>
  <button type='button' class='btn btn-sm btn-light' 
          title='ููุฏูุฉ ูู ุงูุงุฑุดุงุฏ ุงูุณูุงุญู-CH12-U02.pptx ุดุฑูุญุฉ ุฑูู : 1'>
    <i class='fa-duotone fa-light fa-file-ppt text-danger me-2'></i>
  </button>
</div>
```

---

## โ ุงูุญู ุงููุทุจู

### 1. **ุฅุถุงูุฉ ุญุฒู HTML** โ

```yaml
dependencies:
  flutter_html: ^3.0.0  # ูุนุฑุถ HTML ูู Flutter
  html: ^0.15.6         # ููุนุงูุฌุฉ ูุชุญููู HTML
```

### 2. **ุฅูุดุงุก `HtmlUtils`** โ

**ุงูููู**: `lib/core/utils/html_utils.dart`

#### ุงูุฏูุงู ุงููุชููุฑุฉ:

##### `extractSources()` - ุงุณุชุฎุฑุงุฌ ุงููุตุงุฏุฑ
```dart
List<SourceInfo> sources = HtmlUtils.extractSources(htmlContent);
// ูุณุชุฎุฑุฌ ูุนูููุงุช ุงููุตุงุฏุฑ ูู <div class="sources">
```

**ูุง ุชุณุชุฎุฑุฌู**:
- ุนููุงู ุงููุตุฏุฑ ูู `title` attribute
- ููุน ุงูููู ูู class ุงูุฃููููุฉ:
  - `fa-file-ppt` โ PowerPoint
  - `fa-file-pdf` โ PDF
  - `fa-file-word` โ Word
  - `fa-file-excel` โ Excel

##### `cleanHtml()` - ุชูุธูู HTML
```dart
String cleanHtml = HtmlUtils.cleanHtml(htmlContent);
// ูุญุฐู <div class="sources"> ูุน ุงูุญูุงุธ ุนูู ุจุงูู HTML
```

##### `htmlToPlainText()` - ุชุญููู ุฅูู ูุต ุนุงุฏู
```dart
String plainText = HtmlUtils.htmlToPlainText(htmlContent);
// ูุญูู HTML ุฅูู ูุต ุนุงุฏู ุจุงููุงูู
```

##### `htmlToFormattedText()` - ุชุญููู ูุน ุงูุชูุณูู
```dart
String formattedText = HtmlUtils.htmlToFormattedText(htmlContent);
// ูุญูู HTML ุฅูู ูุต ูุน ุญูุธ ุงูููุฑุงุช ูุงูุฃุณุทุฑ
```

##### `containsHtml()` - ุงูุชุญูู ูู HTML
```dart
bool hasHtml = HtmlUtils.containsHtml(content);
// ูุชุญูู ูู ูุฌูุฏ HTML tags ูู ุงููุต
```

---

### 3. **ุชุญุฏูุซ `MessageBubble`** โ

**ุงูููู**: `lib/features/chat/presentation/widgets/message_bubble.dart`

#### ููุฒุงุช ุฌุฏูุฏุฉ:

##### ุฃ. ุฏุงูุฉ `_buildMessageText()`
ุชุนุฑุถ ุงููุญุชูู ุจูุงุกู ุนูู ููุนู:

```dart
// ุฑุณุงุฆู ุงููุณุงุนุฏ ุจู HTML
if (isAssistant && hasHtml) {
  return Column(
    children: [
      Html(data: cleanedHtml),  // ุงููุญุชูู
      _buildSources(sources),    // ุงููุตุงุฏุฑ
    ],
  );
}

// ุฑุณุงุฆู ุงููุณุชุฎุฏู ุจูุต ุนุงุฏู
return Text(content);
```

##### ุจ. ุฏุงูุฉ `_buildSources()`
ุชุนุฑุถ ูุณู ุงููุตุงุฏุฑ ุจุชุตููู ุฌููู:

```dart
Container(
  decoration: BoxDecoration(...),
  child: Column(
    children: [
      Row([
        Icon(FontAwesomeIcons.bookOpen),
        Text('ุงููุตุงุฏุฑ'),
      ]),
      Wrap([
        _buildSourceChip(source1),
        _buildSourceChip(source2),
        ...
      ]),
    ],
  ),
)
```

##### ุฌ. ุฏุงูุฉ `_buildSourceChip()`
ุชุนุฑุถ chip ููู ูุตุฏุฑ ูุน ุฃููููุชู:

**ุงูุฃููููุงุช ุญุณุจ ููุน ุงูููู**:
- ๐ง PPT โ `FontAwesomeIcons.filePowerpoint` (ุจุฑุชูุงูู)
- ๐ด PDF โ `FontAwesomeIcons.filePdf` (ุฃุญูุฑ)
- ๐ต Word โ `FontAwesomeIcons.fileWord` (ุฃุฒุฑู)
- ๐ข Excel โ `FontAwesomeIcons.fileExcel` (ุฃุฎุถุฑ)
- โซ ุฃุฎุฑู โ `FontAwesomeIcons.file` (ููู ุงูุชุทุจูู)

---

## ๐จ ููู ูุจุฏู ูู ุงูุชุทุจูู

### ุฑุณุงูุฉ ุงููุณุงุนุฏ:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐ค ูุณุงุนุฏ ููู                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                    โ
โ ููุฑุฑ ููุฏูุฉ ูู ุงูุฅุฑุดุงุฏ ุงูุณูุงุญู    โ
โ ูุชูุงูู ุชุนุฑูู ุงูุฅุฑุดุงุฏ ุงูุณูุงุญู...   โ
โ                                    โ
โ ุจุดูู ุนุงูุ ููุฏู ุงูููุฑุฑ ุฅูู...      โ
โ                                    โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ โ ๐ ุงููุตุงุฏุฑ                   โ   โ
โ โ                              โ   โ
โ โ [๐ ููู 1] [๐ ููู 2]       โ   โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                    โ
โ ููุฐ 5 ุฏูุงุฆู                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ุฑุณุงูุฉ ุงููุณุชุฎุฏู:

```
                    โโโโโโโโโโโโโโโโโโโโโ
                    โ ุนู ูุชุญุฏุซ ุงูููุฑุฑุ โ
                    โ                   โ
                    โ ููุฐ 5 ุฏูุงุฆู      โ
                    โโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ฆ ุงููููุงุช ุงููุนุฏูุฉ

1. โ `lib/core/utils/html_utils.dart` - **ุฌุฏูุฏ**
2. โ `lib/features/chat/presentation/widgets/message_bubble.dart` - **ูุญุฏุซ**
3. โ `pubspec.yaml` - ุฅุถุงูุฉ `flutter_html` ู `html`

---

## ๐ ููู ูุนูู

### ุชุฏูู ุงูุจูุงูุงุช:

```
API Response (HTML)
       โ
MessageDto.content
       โ
ChatNotifier (Message)
       โ
MessageBubble
       โ
_buildMessageText()
       โโโ ุงุณุชุฎุฑุงุฌ ุงููุตุงุฏุฑ (extractSources)
       โโโ ุชูุธูู HTML (cleanHtml)
       โโโ ุนุฑุถ HTML (Html widget)
       โโโ ุนุฑุถ ุงููุตุงุฏุฑ (_buildSources)
```

---

## ๐ฏ ุงูููุฒุงุช ุงูุฅุถุงููุฉ

### 1. ูุนุงูุฌุฉ ุฐููุฉ ูููุญุชูู
- โ ูุชุนุฑู ุชููุงุฆูุงู ุนูู HTML
- โ ูุนุฑุถ HTML ูููุณุงุนุฏ ููุท
- โ ูุญูู HTML ุฅูู ูุต ูููุณุชุฎุฏู

### 2. ุงุณุชุฎุฑุงุฌ ูุฑู ูููุตุงุฏุฑ
- โ ูุฏุนู ุฃููุงุน ูููุงุช ูุชุนุฏุฏุฉ
- โ ูุณุชุฎุฑุฌ ุงูุนููุงู ูู `title` attribute
- โ ูุญุฏุฏ ุงูููุน ูู class ุงูุฃููููุฉ

### 3. ุชุตููู ุงุญุชุฑุงูู
- โ ุฃููููุงุช ููููุฉ ุญุณุจ ููุน ุงูููู
- โ chips ุฌูููุฉ ูููุตุงุฏุฑ
- โ ูุณุงุญุฉ ูููุตูุฉ ูููุตุงุฏุฑ

---

## ๐งช ุงุฎุชุจุงุฑ

### ุจูุงูุงุช ุงุฎุชุจุงุฑ ุญููููุฉ:

ูู `test_chat_session.dart`:
```dart
final sessionId = 'd5dfcc59-f2e2-47cc-ac92-ffe9baa96a28';
final session = await api.getSession(sessionId);
// ุณูุนุฑุถ ุฑุณุงูุชูู:
// 1. ุณุคุงู ุงููุณุชุฎุฏู (ูุต ุนุงุฏู)
// 2. ุฑุฏ ุงููุณุงุนุฏ (HTML + ูุตุงุฏุฑ)
```

---

## โจ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

โ ุฑุณุงุฆู ุงููุณุงุนุฏ ุชูุนุฑุถ ุจุชูุณูู HTML ุฌููู
โ ุงููุตุงุฏุฑ ุชูุนุฑุถ ุจุฃููููุงุช FontAwesome ููููุฉ
โ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุงุญุชุฑุงููุฉ ูุณูุณุฉ
โ ูุนุงูุฌุฉ ุฐููุฉ ูุฃููุงุน ุงููุญุชูู ุงููุฎุชููุฉ

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ (ุงุฎุชูุงุฑูุฉ)

1. ุฅุถุงูุฉ ุฅููุงููุฉ ุงูููุฑ ุนูู ุงููุตุงุฏุฑ
2. ุฅุถุงูุฉ ูุนุงููุฉ ูููุตุฏุฑ ุนูุฏ ุงูููุฑ
3. ุฏุนู ุงููุฒูุฏ ูู ุฃููุงุน ุงููููุงุช
4. ุฅุถุงูุฉ ุฑุณูู ูุชุญุฑูุฉ ูููุตุงุฏุฑ

---

ุชู ุจูุฌุงุญ! ๐

